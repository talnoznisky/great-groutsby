<html>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0">
    <body>
        <h3>The Great Groutsby</h3>
        <div class="dedication">
            <p>Once again to Zelda</p>
            </div>
            <div class="epigraph">
            <blockquote class="verse"><div>
            <p><span>Then wear the gold hat, if that will move her;</span><br>
            <span class="i1">If you can bounce high, bounce for her too,</span><br>
            <span>Till she cry “Lover, gold-hatted, high-bouncing lover,</span><br>
            <span class="i1">I must have you!”</span></p>
            <p><cite>Thomas Parke d’Invilliers</cite></p>
            </div></blockquote>
            </div>
        <div id='root'></div>

    </body>
    <script>

        function createParagraph(line){
            paragraph = document.createElement('p')
            paragraph.textContent = line

            return paragraph
        }

        function createChapter(chapter){
            root = document.getElementById('root')
            
            chapterDiv = document.createElement('div')
            chapterDiv.setAttribute('id', chapter["chapter"])
            chapterDiv.classList.add('chapter')
            
            headerDiv = document.createElement('div')
            headerDiv.classList.add('header')

            headerDiv.textContent = chapter['chapter_name']
            
            chapterDiv.append(headerDiv)
            root.append(chapterDiv)
        };

        function getSortedLines(lines, sort){
            newArr = []
            lines.forEach(line => {
                newArr.push(line[`${sort}`])
            })
            return newArr
        };

        async function getJSON(file_name){
            const file = `${file_name}.json`
            const response = await fetch(file)
            const data = await response.json()

            return data
        }

        (async() => {
            function appendData(data){
                root = document.getElementById('root')
                data.forEach(element => {
                    root.append(element['line'].replaceAll('Gatsby', 'Groutsby'))
                });
            }

            const sentences = await getJSON('lines')
            const p_indices = await getJSON('p_indices')

            const sorted = getSortedLines(sentences, 'default')

            p_indices.forEach(p => {
                root = document.getElementById('root')

                let s = ''
                if(p.length == 1){
                    s += sorted[p[0]]
                }else if (p.length > 1){
                    sorted.slice(p[0], p[p.length-1] + 1).forEach(line => {s+= line + ' '})
                }
                
                s = s.replaceAll('Gatsby', 'Groutsby')
                
                paragraph = createParagraph(s)
                root.append(paragraph)
            })

        })();    
        </script>

</html>



